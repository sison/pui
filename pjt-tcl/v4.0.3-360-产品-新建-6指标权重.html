<!DOCTYPE html>
<html lang="zh-cn">

<head>
    <meta charset="UTF-8">
    <title>v4.0.3-360-指标权重</title>
    <link rel="stylesheet" rev="stylesheet" type="text/css" href="assets/admin/v4.0.3/css/pui.css" />
    <link rel="stylesheet" rev="stylesheet" type="text/css" href="assets/admin/v4.0.3/css/layout.css" />
    <link rel="stylesheet" rev="stylesheet" type="text/css" href="assets/admin/v4.0.3/css/page-common.css" />
    <link rel="stylesheet" rev="stylesheet" type="text/css" href="assets/libs/jeDate/jedate/skin/jedate.css" />
    <script type="text/javascript" src="assets/libs/jquery-1.11.0.min.js"></script>
    <script type="text/javascript" src="assets/libs/jeDate/jedate/jedate.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/layout.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-popop.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-page.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-ceng.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-radio.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-checkbox.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-table.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-query.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-valid.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-select.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-switch.js"></script>
    <script type="text/javascript" src="assets/admin/v4.0.3/js/components/pui-tree.js"></script>
    <script type="text/javascript" src="assets/libs/jquery-tmpl/jquery.tmpl.min.js"></script>
    <script type="text/javascript" src="assets/libs/kindeditor/kindeditor-min.js"></script>
    <script type="text/javascript">
    $(function() {
        importHeader();
        importFooter();
    });
    </script>
</head>

<body>
    <div class="page-content">
        <div class="widthly">
            <div class="page-crumb">
                <p>
                    <a href="/System/Home/Index">项目管理</a>
                    <em>/</em>
                    <a href="/System/CustomerGroup/List">项目列表</a>
                    <em>/</em>
                    <a href="/System/CustomerGroup/List">顺丰集团素质测评</a>
                    <em>/</em>
                    <span>进度统计</span>
                </p>
            </div>
            <div class="bbthree">
                <div class="page-step fm ffs">
                    <ul>
                        <li class="cur"><a href="javascript:void(0);" class="ant">1 产品信息<i></i></a></li>
                        <li class="cur"><a href="javascript:void(0);" class="ant">2 选择模型<i></i></a></li>
                        <li class="cur"><a href="javascript:void(0);" class="ant">3 模型结构<i></i></a></li>
                        <li class="cur"><a href="javascript:void(0);" class="ant">4 评价问卷<i></i></a></li>
                        <li class="cur"><a href="javascript:void(0);" class="ant">5 评价关系<i></i></a></li>
                        <li class="cur"><a href="javascript:void(0);" class="ant">6 指标权重<i></i></a></li>
                        <li><a href="javascript:void(0);" class="ant">7 完成<i></i></a></li>
                    </ul>
                </div>
                <div class="pd20 tc clearfix">
                    <form class="pui-form" id="moduleConstruction">
                        <div class="sp20"></div>
                        <div class="ext-table-to-div" id="weightTree"></div>
                        <div class="absolutecenter clearfix">
                            <div class="sp50"></div>
                            <div class="acsub">
                                <button class="btn bb bgc-blue fm" id="btn-opt-prev">上一步</button>
                            </div>
                            <div class="acsub">
                                <button class="btn bb bgc-blue fm" id="btn-opt-next" type="submit">下一步</button>
                            </div>
                            <div class="acsub">
                                <button class="btn bb btn-common btn-cancel fm" id="btn-opt-cancel">取消</button>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
<script type="text/javascript">
$(function() {



    var valid = new Valid();
    valid.form($('#moduleConstruction'), {
        isAsync: true,
        asyncFun: function() {
            ceng.msg('最近好捻烦！');
            // var _html = '';
            // _html += '<div class="lh24 tl">';
            // _html += '<p>当前模型指标修改将影响</p>';
            // _html += '<p>1、模型库中该模型被修改</p>';
            // _html += '<p>2、影响该模型生成的其他评估内容库中的评估内容对应的模型指标被修改</p>';
            // _html += '<div class="sp20"></div>';
            // _html += '<p>确认保存吗？</p>';
            // _html += '</div>';
            // ceng.comfirm(_html, {
            //     title: '提示',
            //     btn: ['确定', '取消'],
            //     area: [400, 'auto'],
            //     yes: function(obj, index) {
            //         ceng.msg('弄死那个逗比！');
            //         ceng.close(index);
            //     }
            // })
        }
    });


    
        var startData = {
            zid: '0001',
            value: '都城的饭好难吃',
            themeStyle: 2,
            theme1: {
                zid: '00031',
                value: '一级指标1111111111',
                defined: 1,
                grade1: 1,
                grade2: 1,
                grade3: 1,
                children: []
            },
            theme2: {
                zid: '00031',
                value: '一级指标99999999',
                defined: 1,
                grade1: 1,
                grade2: 1,
                grade3: 1,
                children: [{
                    zid: '00031',
                    value: '二级指标222222222',
                    defined: 1,
                    grade1: 1,
                    grade2: 1,
                    grade3: 1,
                    children: []
                }]
            },
            theme3: [{
                zid: '00031',
                value: '一级指标1',
                defined: 1,
                grade1: 1,
                grade2: 1,
                grade3: 1,
                children: [{
                    zid: '000211',
                    value: '二级指标',
                    defined: 1,
                    grade1: 1,
                    grade2: 1,
                    grade3: 1,
                    children: [{
                        zid: '000211',
                        value: '三级指标',
                        defined: 1,
                        grade1: {
                            name: 'abcde',
                            val: 999
                        },
                        grade2: {
                            name: 'abcde',
                            val: 999
                        },
                        grade3: {
                            name: 'abcde',
                            val: 999
                        },
                        children: []
                    }]
                }, {
                    zid: '000211',
                    value: '二级指标',
                    defined: 1,
                    grade1: 1,
                    grade2: 1,
                    grade3: 1,
                    children: [{
                        zid: '000211',
                        value: '三级指标',
                        defined: 1,
                        grade1: 1,
                        grade2: 1,
                        grade3: 1,
                        children: []
                    }, {
                        zid: '000211',
                        value: '三级指标',
                        defined: 1,
                        grade1: 1,
                        grade2: 1,
                        grade3: 1,
                        children: []
                    }, {
                        zid: '000211',
                        value: '三级指标',
                        defined: 1,
                        grade1: 1,
                        grade2: 1,
                        grade3: 1,
                        children: []
                    }]
                }]
            }, {
                zid: '00031',
                value: '一级指标2',
                defined: 1,
                grade1: 1,
                grade2: 1,
                grade3: 1,
                children: [{
                    zid: '000211',
                    value: '二级指标',
                    defined: 1,
                    grade1: 1,
                    grade2: 1,
                    grade3: 1,
                    children: []
                }, {
                    zid: '000211',
                    value: '二级指标',
                    defined: 1,
                    grade1: 1,
                    grade2: 1,
                    grade3: 1,
                    children: [{
                        zid: '000211',
                        value: '三级指标',
                        defined: 1,
                        grade1: 1,
                        grade2: 1,
                        grade3: 1,
                        children: []
                    }]
                }]
            }]
        }



        var tree = new Object();

        tree.dom = $('#weightTree');
        tree.main = [true, true, false, false, false];
        tree.width = ['35%', '35%', '10%', '10%', '10%'];
        tree.alias = ['th1', 'th2', 'th3', 'th4', 'th5'];
        tree.header = [{
            title: '',
            formatter: function() {
                return '<div class="tl"><span class="pdl10 pdr10 fl">指标展开</span><div class="select-group fl"><select id="changeLevel" class="select" data-width="75px"><option value="1">一级</option><option value="2">二级</option><option value="3" selected>三级</option></select></div></div>';
            }
        }, {
            title: '',
            formatter: function() {
                return '<p>指标权重</p>';
            }
        }, {
            title: '',
            formatter: function() {
                return '<p>上级</p>';
            }
        }, {
            title: '',
            formatter: function() {
                return '<p>同级</p>';
            }
        }, {
            title: '',
            formatter: function() {
                return '<p>下级</p>';
            }
        }];
        tree.headersub = [{
            title: '',
            formatter: function() {
                return '<p class="tl fs fbold pdl10 c-gray4"><span>模块名称</span><span class="pdl10 c-gray2">' + startData.value + '</span></p>';
            }
        }, {
            title: '',
            formatter: function() {
                return '<div class="por100"><div style="padding-left: 10px;"><input type="text" class="txt wp100 tc c-gray3 disabled" disabled data-req="true" value="1" /></div><div class="abs tl"><span class="pdl10 c-gray3">100%</span></div></div>';
            }
        }, {
            title: '',
            formatter: function() {
                var _html = '';
                _html += '<div class="relative">';
                _html += '<div class="absolute w300 clearfix pdl10 c-gray3 tl">';
                _html += '<div class="fl pdr10 pdl10">选择权重设置的指标层级</div>';
                _html += '<div class="select-group fl">';
                _html += '<select id="changeWeight" class="select" data-width="75px">';
                _html += '<option value="1">一级</option>';
                _html += '<option value="2">二级</option>';
                _html += '<option value="3">三级</option>';
                _html += '</select>';
                _html += '</div>';
                _html += '<div class="txt-group fl">';
                _html += '<div class="popop pop-bottom mgl10" data-lean="right" data-width="280px">';
                _html += '<a href="javascript:void(0)" class="c-gray4"><i class="icon icon-sign-full fb"></i></a>';
                _html += '<div class="popsub ffs fs c-brown">';
                _html += '<p>权重设置只能挑选一个层级进行设置，一旦选定且设置权重，其他层级权重不计算。只能输入大于0的正整数。</p>';
                _html += '</div>';
                _html += '</div>';
                _html += '</div>';
                _html += '</div>';
                _html += '</div>';
                return _html;
            }
        }, {
            title: '',
            formatter: function() {
                return '';
            }
        }, {
            title: '',
            formatter: function() {
                return '';
            }
        }];
        tree.collapse = [{
            title: 'value',
            formatter: function(val) {
                return '<input type="text" class="txt wp100 disabled" disabled data-req="true" value="' + val + '" /> ';
            }
        }, {
            title: 'defined',
            formatter: function(val) {
                return '<div class="por100"><input type="text" class ="txt wp100 tc c-gray3 zbweight" data-req="true" value ="' + val + '" /><div class="abs tl"><span class="pdl10 c-gray3 zbprecent">100%</span></div></div> ';
            }
        }, {
            title: 'grade1',
            formatter: function(val) {
                if (typeof val === 'object') {
                    return ' <div class="pdl10 pdr10"><input type="text" name="' + val.name + '" class ="txt wp100 tc c-gray3" data-req="true" value ="' + val.val + '" /></div> ';
                } else {
                    return ' <div class="pdl10 pdr10"><input type="text" class ="txt wp100 tc c-gray3" data-req="true" value ="' + val + '" /></div> ';
                }
            }
        }, {
            title: 'grade2',
            formatter: function(val) {
                return ' <div class="pdl10 pdr10"><input type="text" class ="txt wp100 tc c-gray3" data-req="true" value ="' + val + '" /></div> ';
            }
        }, {
            title: 'grade3',
            formatter: function(val) {
                return ' <div class="pdl10 pdr10"><input type="text" class ="txt wp100 tc c-gray3" data-req="true" value ="' + val + '" /></div> ';
            }
        }];


        var changePrecent = function(self) {
            self.on('change', 'input.zbweight', function() {
                var row = $(this).closest('.row');
                var rowul = row.closest('ul') || null;
                var siblings = row.siblings('.row');
                if (siblings.length > 0) {
                    var totalscore = 0;
                    for (var i = 0, leng = siblings.length + 1; i < leng; i++) {
                        totalscore += parseInt(rowul.children('.row').eq(i).find('.zbweight').val());
                    }
                    totalscore;
                    rowul.children('.row').each(function() {
                        createRowResult.call($(this).find('.zbweight').eq(0), totalscore);
                    })
                } else {
                    debugger;
                    row.find('.zbprecent').text('100%');
                }
            });
        }
        var createRowResult = function(total) {
            var result = parseInt(this.val()) / total;
            result = result * 100;
            result = result.toString().indexOf('.') > -1 ? result.toFixed(2) : result;
            result += '%';
            this.next().find('.zbprecent').text(result);
            // debugger;
        }
        var changeWeight = function(self) {
            $('#changeWeight', self).selectSmart({
                callback: function(i, k, v) {
                    switch (v) {
                        case '1':
                            self.find('.ext-body > ul >li > div')
                            break;
                        case '2':
                            break;
                        case '3':
                            break;
                    }
                }
            });
        }
        var toggleLevel = function(self) {
            $('#changeLevel', self).selectSmart({
                callback: function(i, k, v) {
                    switch (v) {
                        case '1':
                            var togger1 = self.find('.ext-body > ul > li > .mainkey i.icon-toggle');
                            Pui.togExpand(togger1);
                            break;
                        case '2':
                            var togger1 = self.find('.ext-body > ul > li > .mainkey i.icon-toggle');
                            Pui.togCollapse(togger1);
                            var togger2 = self.find('.ext-body > ul > li > ul > li > .mainkey i.icon-toggle');
                            Pui.togExpand(togger2);
                            break;
                        case '3':
                            var togger1 = self.find('.ext-body > ul > li > .mainkey i.icon-toggle');
                            Pui.togCollapse(togger1);
                            var togger2 = self.find('.ext-body > ul > li > ul > li > .mainkey i.icon-toggle');
                            Pui.togCollapse(togger2);
                            break;
                    }
                }
            });
        }

        var treeWeight = new Tree({
            tree: tree.dom,
            data: startData.theme3,
            main: tree.main,
            width: tree.width,
            alias: tree.alias,
            // 头部
            header: tree.header,
            // 副头部
            headersub: tree.headersub,
            // 列表树
            collapse: tree.collapse,
            callback: function(self) {
                toggleLevel(self);
                changePrecent(self);
                changeWeight(self);
            }
        });
        treeWeight.init();












})
</script>

</html>
